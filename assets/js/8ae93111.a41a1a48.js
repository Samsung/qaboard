"use strict";(self.webpackChunkApache_2_0=self.webpackChunkApache_2_0||[]).push([[3187],{3905:function(e,t,a){a.d(t,{Zo:function(){return m},kt:function(){return u}});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function c(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=n.createContext({}),l=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):c(c({},t),e)),a},m=function(e){var t=l(e.components);return n.createElement(s.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,m=o(e,["components","mdxType","originalType","parentName"]),d=l(a),u=r,h=d["".concat(s,".").concat(u)]||d[u]||p[u]||i;return a?n.createElement(h,c(c({ref:t},m),{},{components:a})):n.createElement(h,c({ref:t},m))}));function u(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=a.length,c=new Array(i);c[0]=d;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o.mdxType="string"==typeof e?e:r,c[1]=o;for(var l=2;l<i;l++)c[l]=a[l];return n.createElement.apply(null,c)}return n.createElement.apply(null,a)}d.displayName="MDXCreateElement"},5610:function(e,t,a){a.r(t),a.d(t,{frontMatter:function(){return s},contentTitle:function(){return l},metadata:function(){return m},toc:function(){return p},default:function(){return u}});var n=a(7462),r=a(3366),i=(a(7294),a(3905)),c=a(4996),o=["components"],s={id:"bit-accuracy",sidebar_label:"Bit Accuracy",title:"Bit accuracy tests"},l=void 0,m={unversionedId:"bit-accuracy",id:"bit-accuracy",title:"Bit accuracy tests",description:"QA-Board was started at Samsung, within a business unit focused on hardware digital design. Because of those root, QA-Board provides a number of ways to check that results are equal from commit to commit.",source:"@site/docs/bit-accuracy.md",sourceDirName:".",slug:"/bit-accuracy",permalink:"/qaboard/docs/bit-accuracy",editUrl:"https://github.com/Samsung/qaboard/edit/master/website/docs/docs/bit-accuracy.md",tags:[],version:"current",frontMatter:{id:"bit-accuracy",sidebar_label:"Bit Accuracy",title:"Bit accuracy tests"},sidebar:"docs",previous:{title:"Metadata & External Databases",permalink:"/qaboard/docs/metadata-integration-external-databases"},next:{title:"FAQ",permalink:"/qaboard/docs/faq"}},p=[{value:"&quot;Soft&quot; bit-accuracy checks from the UI",id:"soft-bit-accuracy-checks-from-the-ui",children:[{value:"&quot;Hard&quot; <code>qa check-bit-accuracy</code> on the CLI",id:"hard-qa-check-bit-accuracy-on-the-cli",children:[],level:3},{value:"What files are checked?",id:"what-files-are-checked",children:[],level:3}],level:2},{value:"Sample CI for bit-accuracy checks",id:"sample-ci-for-bit-accuracy-checks",children:[],level:2},{value:"Custom output comparisons",id:"custom-output-comparisons",children:[],level:2}],d={toc:p};function u(e){var t=e.components,a=(0,r.Z)(e,o);return(0,i.kt)("wrapper",(0,n.Z)({},d,a,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"QA-Board was started at Samsung, within a business unit focused on hardware digital design. Because of those root, QA-Board provides a number of ways to check that results are equal from commit to commit."),(0,i.kt)("h2",{id:"soft-bit-accuracy-checks-from-the-ui"},'"Soft" bit-accuracy checks from the UI'),(0,i.kt)("p",null,"The web application lets you view and compare all files created by your algorithm's runs:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Files are marked depending on their status (identical, different, added, removed...). Identical files are hidden by default."),(0,i.kt)("li",{parentName:"ul"},"You can click on each file to open it with an appropriate file viewer:")),(0,i.kt)("img",{alt:"bit accuracy viewer",src:(0,c.Z)("img/bit-accuracy-viewer.jpg")}),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"The UI doesn't care about ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/Samsung/qaboard/blob/master/qaboard/sample_project/qaboard.yaml#L93"},(0,i.kt)("em",{parentName:"a"},"qaboard.yaml")),"'s ",(0,i.kt)("inlineCode",{parentName:"p"},"bit-accuracy.patterns")," ",(0,i.kt)("em",{parentName:"p"},"(discussed later)"),"."))),(0,i.kt)("h3",{id:"hard-qa-check-bit-accuracy-on-the-cli"},'"Hard" ',(0,i.kt)("inlineCode",{parentName:"h3"},"qa check-bit-accuracy")," on the CLI"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"qa check-bit-accuracy $batch")," compares the results of ",(0,i.kt)("inlineCode",{parentName:"p"},"qa batch $batch")," to:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"The latest results on ",(0,i.kt)("inlineCode",{parentName:"li"},"project.reference_branch")," from ",(0,i.kt)("a",{parentName:"li",href:"https://github.com/Samsung/qaboard/blob/master/qaboard/sample_project/qaboard.yaml"},(0,i.kt)("em",{parentName:"a"},"qaboard.yaml"))," (default: ",(0,i.kt)("em",{parentName:"li"},"master"),")."),(0,i.kt)("li",{parentName:"ul"},"...unlesss you're checking a merge made to that branch. In which case the commit's parents will act as references."),(0,i.kt)("li",{parentName:"ul"},"You can ask to compare versus a specific git commit, branch or tag with ",(0,i.kt)("inlineCode",{parentName:"li"},"qa check-bit-accuracy --reference $git-ref"),".")),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"If the commit you compare against has not finished its CI, ",(0,i.kt)("inlineCode",{parentName:"p"},"qa")," will  wait.")),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"Custom Needs")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"You can opt-in to more complex behaviour in ",(0,i.kt)("em",{parentName:"p"},(0,i.kt)("a",{parentName:"em",href:"https://github.com/Samsung/qaboard/blob/master/qaboard/sample_project/qaboard.yaml"},"qaboard.yaml"))," with ",(0,i.kt)("inlineCode",{parentName:"p"},"bit-accuracy.on_reference_failed_ci"),", in case there are not results in the reference commit. Maybe the build failed, in which case you want to compare against the previous commit... If you're interested open an issue we'll add more details to the docs."))),(0,i.kt)("p",null,"If output files are different, ",(0,i.kt)("inlineCode",{parentName:"p"},"qa")," prints a report and exists with a failure."),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"For specific use-case, there is also ",(0,i.kt)("inlineCode",{parentName:"p"},"qa check-bit-accuracy-manifest")," which checks accuracy versus a manifest file stored in the database next to the input files. To generate those manifests, use ",(0,i.kt)("inlineCode",{parentName:"p"},"qa batch --save-manifests-in-database"),"."))),(0,i.kt)("h3",{id:"what-files-are-checked"},"What files are checked?"),(0,i.kt)("p",null,"Files matching the patterns defined as ",(0,i.kt)("inlineCode",{parentName:"p"},"bit-accuracy.patterns")," in ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/Samsung/qaboard/blob/master/qaboard/sample_project/qaboard.yaml#L93"},(0,i.kt)("em",{parentName:"a"},"qaboard.yaml"))," will be checked."),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"If you work with text files on both Linux and Windows, EOL can make things tricky... You can decide what files are plaintext or binary using ",(0,i.kt)("inlineCode",{parentName:"p"},"bit-accuracy.plaintext")," ",(0,i.kt)("em",{parentName:"p"},"or")," ",(0,i.kt)("inlineCode",{parentName:"p"},"bit-accuracy.binary"),"."))),(0,i.kt)("h2",{id:"sample-ci-for-bit-accuracy-checks"},"Sample CI for bit-accuracy checks"),(0,i.kt)("p",null,"You often want to know when your algorithm's results change, ",(0,i.kt)("em",{parentName:"p"},"especially if another team is busy implementing them in hardware"),"!"),(0,i.kt)("p",null,"Here is how you could get the CI to warn you with GitlabCI:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title="qaboard.yaml"',title:'"qaboard.yaml"'},"stages:\n  - tests\n  - bit-accuracy\n\ntests-all:\n  stage: tests\n  script:\n  - qa batch all\n\nbit-accuracy-all:\n  stage: bit-accuracy\n  allowed_failure: true\n  script:\n  - qa check-bit-accuracy --batch all\n")),(0,i.kt)("h2",{id:"custom-output-comparisons"},"Custom output comparisons"),(0,i.kt)("p",null,'Bit accuracy checks in QA-Board are done by checking the hashes of your output files. To make it fast, those hashes are computed once, and stored in "manifest" files to make it fast, along with other file metadata.'),(0,i.kt)("p",null,'In some cases, you may want to compare files using something else than bit-exactness between files. Maybe you want to ignore timestamps, or maybe you want to do "semantic" comparaions... To to this, you can supply your own comparaison function:'),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Implement a ",(0,i.kt)("inlineCode",{parentName:"li"},"cmp")," function in some ",(0,i.kt)("em",{parentName:"li"},"file.py"),":")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},'from pathlib import Path\n\ndef cmp(path1 : Path, path2 : Path) -> bool\n  """Checks if the files have the same content, like QA-Board does by default"""\n  return path1.read_bytes() == path2.read_bytes()\n')),(0,i.kt)("ol",{start:2},(0,i.kt)("li",{parentName:"ol"},"Ask ",(0,i.kt)("inlineCode",{parentName:"li"},"qa")," to use it:")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"export QA_BITACCURACY_CMP=/path/to/file.py\nqa check-bit-accuracy --batch <batch_name>\n")))}u.isMDXComponent=!0}}]);